"use strict";(self.webpackChunkcedri_ugv_dashboard=self.webpackChunkcedri_ugv_dashboard||[]).push([[871],{59871:function(e,t,n){n.r(t),n.d(t,{default:function(){return Z}});var a=n(82937),r=n(1413),i=n(15671),c=n(43144),o=n(60136),l=n(27277),s=n(47313),u=n(78315),d=n(95436),p=n(96543),g=n(89755),m=n(91372),h=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},f=(0,s.forwardRef)((function(e,t){var n=e.chartRef,a=e.style,r=void 0===a?{height:"inherit"}:a,i=e.className,c=e.loading,o=e.loadingTemplate,l=e.errorTemplate,f=h(e,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),y=(0,d.Z)(u.Area,f),v=y.chart,$=y.container;return(0,s.useEffect)((function(){(0,p.J)(n,v.current)}),[v.current]),(0,s.useImperativeHandle)(t,(function(){return{getChart:function(){return v.current}}})),s.createElement(g.Z,{errorTemplate:l},c&&s.createElement(m.Z,{loadingTemplate:o,theme:e.theme}),s.createElement("div",{className:i,style:r,ref:$}))})),y=n(8515),v=n(8200),$={graph:{big:{width:800,height:400},medium:{width:400,height:200},small:{width:200,height:200}},stack:{direction:"column",alignItems:"center",spacing:1},typography:{variant:"h5",color:"textSecondary"},box:{sx:{p:2,pb:1}},maincard:{sx:{mt:2},content:!1}},x=n(16157),b=n(62463),k=n(42669),w=n(46417),j=JSON.stringify({dataSource:"CeDRI",database:"CeDRI_UGV_dashboard",collection:"Battery_Data",pipeline:[{$project:{dateTime:{$dateTrunc:{date:"$dateTime",unit:"minute"}},voltage:{$cond:[{$eq:["NaN","$voltage"]},null,"$voltage"]},current:{$cond:[{$eq:["NaN","$current"]},null,"$current"]},percentage:{$cond:[{$eq:["NaN","$percentage"]},null,"$percentage"]}}},{$densify:{field:"dateTime",range:{step:1,unit:"minute",bounds:"full"}}},{$group:{_id:"$dateTime",percentage:{$avg:"$percentage"},current:{$avg:"$current"},voltage:{$avg:"$voltage"},count:{$sum:1}}},{$sort:{_id:-1}},{$limit:100},{$project:{percentage:{$multiply:["$percentage",100]}}}]}),S=function(e){(0,o.Z)(n,e);var t=(0,l.Z)(n);function n(e){var a;return(0,i.Z)(this,n),(a=t.call(this,e)).componentDidMount=function(){a.timer()},a.componentWillUnmount=function(){clearInterval(a.timer)},a.timer=function(){setInterval((function(){a.canUpdate()}),1e3)},a.config={padding:"auto",xField:"_id",yField:"percentage",xAxis:{tickCount:5,type:"time",mask:"DD/MMM/YY HH:mm",title:{text:"Time"}},yAxis:{tickCount:10,title:{text:"Battery percentage [%]"}},tooltip:{formatter:function(e){return null!=e.percentage?{name:"Percentage",value:e.percentage.toFixed(1)+"%"}:{}}},smooth:!0},a.state={data:[],ticks:-1},a}return(0,c.Z)(n,[{key:"canUpdate",value:function(){JSON.parse(window.localStorage.getItem("fromLocal"))||this.state.ticks<=0?(this.setState({ticks:100}),this.refreshList()):JSON.parse(window.localStorage.getItem("fromLocal"))||this.setState({ticks:this.state.ticks-1})}},{key:"refreshList",value:function(){var e=this;fetch((0,y.H)(),(0,y.w)(j)).then((function(e){return e.json()})).then((function(t){e.setState({data:t})})).catch((function(e){console.log(e)}))}},{key:"render",value:function(){return(0,w.jsx)(v.Z,{sx:$.maincard.sx,content:$.maincard.content,children:(0,w.jsx)(x.Z,{sx:$.box.sx,children:(0,w.jsxs)(b.Z,{spacing:$.stack.spacing,direction:$.stack.direction,alignItems:$.stack.alignItems,children:[(0,w.jsx)(k.Z,{variant:$.typography.variant,color:$.typography.color,children:"Battery percentage by time"}),(0,w.jsx)(f,(0,r.Z)((0,r.Z)({},this.config),{},{data:this.state.data},$.graph.medium))]})})})}}]),n}(s.Component),Z=function(){return(0,w.jsx)(a.ZP,{container:!0,rowSpacing:1.75,columnSpacing:2,children:(0,w.jsx)(S,{})})}}}]);